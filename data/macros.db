{"type":"script","scope":"actor","name":"Second Wind","img":"icons/magic/life/heart-glowing-red.webp","command":"dnd5e.documents.macro.rollItem(\"Second Wind\")","flags":{"dnd5e":{"itemMacro":true}},"author":"Lr8wBSyxt7lTL8nS","folder":null,"sort":0,"ownership":{"default":0,"Lr8wBSyxt7lTL8nS":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1673801319366,"modifiedTime":1673801319366,"lastModifiedBy":"Lr8wBSyxt7lTL8nS"},"_id":"1ivS4weMOWt0AxTu"}
{"type":"script","scope":"actor","name":"Lightning Bolt","img":"icons/magic/lightning/bolt-blue.webp","command":"dnd5e.documents.macro.rollItem(\"Lightning Bolt\")","flags":{"dnd5e":{"itemMacro":true}},"author":"FPvmjzQgqPQsRLle","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1686493629603,"modifiedTime":1686493629603,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"2Nj928V9o2VW0Y6O"}
{"type":"script","scope":"actor","name":"Invisibility","img":"icons/creatures/reptiles/chameleon-camouflage-green-brown.webp","command":"dnd5e.documents.macro.rollItem(\"Invisibility\")","flags":{"dnd5e":{"itemMacro":true}},"author":"FPvmjzQgqPQsRLle","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1677421875339,"modifiedTime":1677421875339,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"3m663TiMlKm8AvxQ"}
{"type":"script","scope":"actor","name":"Levitate","img":"icons/skills/movement/arrow-upward-yellow.webp","command":"dnd5e.documents.macro.rollItem(\"Levitate\")","flags":{"dnd5e":{"itemMacro":true}},"author":"FPvmjzQgqPQsRLle","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1677421876963,"modifiedTime":1677421876963,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"4hY93igFdRM6UQKP"}
{"type":"script","scope":"actor","name":"Меткий выстрел","img":"icons/svg/item-bag.svg","command":"dnd5e.documents.macro.rollItem(\"Меткий выстрел\")","flags":{"dnd5e":{"itemMacro":true}},"author":"Lr8wBSyxt7lTL8nS","folder":null,"sort":0,"ownership":{"default":0,"Lr8wBSyxt7lTL8nS":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1673803016747,"modifiedTime":1673803016747,"lastModifiedBy":"Lr8wBSyxt7lTL8nS"},"_id":"4iH2HqontRIqcZGk"}
{"type":"script","scope":"actor","name":"Пистоль","img":"icons/svg/item-bag.svg","command":"dnd5e.documents.macro.rollItem(\"Пистоль\")","flags":{"dnd5e":{"itemMacro":true}},"author":"Lr8wBSyxt7lTL8nS","folder":null,"sort":0,"ownership":{"default":0,"Lr8wBSyxt7lTL8nS":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1673800925602,"modifiedTime":1673800925602,"lastModifiedBy":"Lr8wBSyxt7lTL8nS"},"_id":"5JTiO9IK35c3T4l2"}
{"name":"Quest Tracker Resizable","type":"script","author":"EdDNDW08Qxax6PVP","img":"modules/forien-quest-log/assets/icons/macros/questTrackerResizableOff.png","scope":"global","command":"const newState = !game.settings.get('forien-quest-log', 'questTrackerResizable');\nawait game.settings.set('forien-quest-log', 'questTrackerResizable', newState);","flags":{"forien-quest-log":{"macro-setting":"questTrackerResizable"},"core":{"sourceId":"Compendium.forien-quest-log.macros-player.PUmh7HIMnMNqCht4"}},"ownership":{"default":0,"EdDNDW08Qxax6PVP":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678629893610,"modifiedTime":1686499841596,"lastModifiedBy":"EdDNDW08Qxax6PVP"},"folder":null,"sort":0,"_id":"5LhI26ELg5LIN9wS"}
{"name":"Apply Damage","type":"script","author":"FFUC3PaRivS4DAFM","img":"icons/svg/dice-target.svg","scope":"global","command":"// Displays a prompt which asks for an amount of damage to inflict\n// Inflicts the input damage amount to all selected tokens\n\nlet content = `\n  <form>\n    <div class=\"form-group\">\n      <label for=\"id=\"damage-amount\">Damage</label>\n      <input id=\"damage-amount\" type=\"number\" name=\"inputField\" autofocus>\n    </div>\n  </form>`\n\nnew Dialog({\n  title: 'How much damage should be applied (negative for healing)?',\n  content: content,\n  buttons:{\n    yes: {\n      icon: \"<i class='fas fa-check'></i>\",\n      label: `Apply Damage`\n    }\n  },\n\n  default:'yes',\n\n  close: html => {\n    let result = html.find('input[name=\\'inputField\\']');\n    if (result.val() !== '') {\n      let damage = result.val();\n      let allSelected = canvas.tokens.controlled\n\n      allSelected.forEach(selected => {\n        let actor = selected.actor\n        let hp = actor.data.data.attributes.hp.value\n        let maxHp = actor.data.data.attributes.hp.max\n\n        let updatedHp = damage > hp ? 0 : hp - damage\n\n        actor.update({'data.attributes.hp.value': updatedHp > maxHp ? maxHp : updatedHp})\n\n        console.log(actor)\n      })\n    }\n  }\n}).render(true);\n\n(async () => {\nawait new Promise(resolve => setTimeout(resolve, 20));\nlet input = $('#damage-amount').focus();\n})();","folder":null,"sort":0,"flags":{"core":{"sourceId":"Macro.7K3qCHAU5AW5TiP4"}},"ownership":{"default":0,"wCsoNxA9I9elUaGF":3,"FFUC3PaRivS4DAFM":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1678629950910,"modifiedTime":1678629950910,"lastModifiedBy":"FFUC3PaRivS4DAFM"},"_id":"5cNJuTPSeBa8lPkm"}
{"type":"script","scope":"actor","name":"Alter Self","img":"icons/magic/control/debuff-energy-hold-green.webp","command":"dnd5e.documents.macro.rollItem(\"Alter Self\")","flags":{"dnd5e":{"itemMacro":true}},"author":"FPvmjzQgqPQsRLle","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1676044877009,"modifiedTime":1676044877009,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"8cBJamY9jW2ZRl8i"}
{"name":"00 - A - Delete filters on Selected","type":"script","author":"FFUC3PaRivS4DAFM","img":"modules/tokenmagic/gui/macros/images/00%20-%20A%20-%20Delete%20filters%20on%20Selected.webp","scope":"global","command":"// Delete all filters on the selected tokens/tiles\nawait TokenMagic.deleteFiltersOnSelected();","folder":null,"sort":0,"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.DCRnfJDBd25fOQxc"}},"ownership":{"default":0,"Njc5YzFjZDI5NjZl":3,"FFUC3PaRivS4DAFM":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1684511351006,"modifiedTime":1684511351006,"lastModifiedBy":"FFUC3PaRivS4DAFM"},"_id":"ABL2n68nipWskGax"}
{"type":"script","scope":"actor","name":"Dancing Lights","img":"icons/magic/light/orbs-firefly-hand-yellow.webp","command":"dnd5e.documents.macro.rollItem(\"Dancing Lights\")","flags":{"dnd5e":{"itemMacro":true}},"author":"FPvmjzQgqPQsRLle","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1677421852146,"modifiedTime":1677421852146,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"AZStpGh0x9TJLddC"}
{"name":"03 - Drop Shadow","type":"script","author":"FFUC3PaRivS4DAFM","img":"modules/tokenmagic/gui/macros/images/03%20-%20Drop%20Shadow.webp","scope":"global","command":"let params =\n[{\n    filterType: \"shadow\",\n    filterId: \"myShadow\",\n    rotation: 35,\n    blur: 2,\n    quality: 5,\n    distance: 20,\n    alpha: 0.7,\n    padding: 10,\n    shadowOnly: false,\n    color: 0x000000,\n    zOrder: 6000,\n    animated:\n    {\n        blur:     \n        { \n           active: true, \n           loopDuration: 500, \n           animType: \"syncCosOscillation\", \n           val1: 2, \n           val2: 4\n        },\n        rotation:\n        {\n           active: true,\n           loopDuration: 100,\n           animType: \"syncSinOscillation\",\n           val1: 33,\n           val2: 37\n        }\n     }\n}];\n\nawait TokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.hayiRem3LXoEP3tL"}},"ownership":{"default":0,"Njc5YzFjZDI5NjZl":3,"FFUC3PaRivS4DAFM":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1684511368614,"modifiedTime":1684511368614,"lastModifiedBy":"FFUC3PaRivS4DAFM"},"_id":"CC0xwBOG1MhAMVXv"}
{"type":"script","scope":"actor","name":"Мушкетон","img":"icons/svg/item-bag.svg","command":"dnd5e.documents.macro.rollItem(\"Мушкетон\")","flags":{"dnd5e":{"itemMacro":true}},"author":"Lr8wBSyxt7lTL8nS","folder":null,"sort":0,"ownership":{"default":0,"Lr8wBSyxt7lTL8nS":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1673791682557,"modifiedTime":1673791682557,"lastModifiedBy":"Lr8wBSyxt7lTL8nS"},"_id":"EiPp8OBMQkyCnjz7"}
{"name":"New Macro","type":"chat","scope":"global","author":"Lr8wBSyxt7lTL8nS","img":"icons/svg/dice-target.svg","command":"","folder":null,"sort":0,"ownership":{"default":0,"Lr8wBSyxt7lTL8nS":3},"flags":{},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1682093194435,"modifiedTime":1682093194435,"lastModifiedBy":"Lr8wBSyxt7lTL8nS"},"_id":"FP0k6jhJNvs9OPSl"}
{"name":"Show Tokens Resistances","type":"script","flags":{"core":{"sourceId":"Macro.4WhSSiHXlbcvP7f6"}},"scope":"global","command":"// Prints the condition immunities, damage immunities, damage resistances and damage vulnerabilities of the currently selected token(s).\n// Damage types that appeared in the previous chat message (e.g. due to a roll) are highlighted in red. \n// A DM can call this macro after a player rolled damage to quickly see if they need to apply full, half or double damage.\n//\n// Author: https://github.com/Nijin22\n// Licence: MIT, see https://choosealicense.com/licenses/mit/\n\nconst damageTypes = [\"Acid\", \"Bludgeoning\", \"Cold\", \"Fire\", \"Force\", \"Lightning\", \"Necrotic\", \"Piercing\", \"Non-Magical Physical\",\n                     \"Piercing\", \"Poison\", \"Psychic\", \"Radiant\", \"Slashing\", \"Thunder\",\n                     \"Bludgeoning, Piercing, and Slashing from Nonmagical Attacks\"];\n\nlet msg = \"\";\nlet previousMessage;\ntry { \n    previousMessage = game.messages.entries[game.messages.entries.length-1].data.content;\n} catch (e) {\n    // No previous message in log. Default to an empty string.\n    previousMessage = \"\";\n}\n\n// Enable case-insensitive replacements\n// Source: https://stackoverflow.com/a/7313467\nString.prototype.replaceAllCaseInsensitive = function(strReplace, strWith) {\n    // See http://stackoverflow.com/a/3561711/556609\n    var esc = strReplace.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n    var reg = new RegExp(esc, 'ig');\n    return this.replace(reg, strWith);\n};\n\n\n// Get traits\nconst traits = new Map();\ntraits.set(\"ci\", \"Condition Immunities\");\ntraits.set(\"di\", \"Damage Immunities (No damage)\");\ntraits.set(\"dr\", \"Damage Resistances (Half damage)\");\ntraits.set(\"dv\", \"Damage Vulnerabilities (Double dmg)\");\ncanvas.tokens.controlled.forEach(token => {\n    let name = token.actor.name;\n    msg += `<h2>${name}</h2>`;\n    \n    traits.forEach((traitDescr, traitId, map) => {\n        // Clone 'default' 5e trait array\n        var allTraits = [...token.actor.data.data.traits[traitId].value];\n        \n        // Custom traits\n        allTraits = allTraits.concat(token.actor.data.data.traits[traitId].custom.split(\";\").map(x => x.trim()));\n        \n        var printableTraits = allTraits.join(\"; \");\n        if (printableTraits.length == 0) {\n            printableTraits = \"-\";\n        }\n        msg += `<h3>${traitDescr}</h3><p>${printableTraits}</p>`;\n    });\n});\n\n// highlight words from previous message\nlet damageTypesOfPrevousMsg = [];\ndamageTypes.forEach(damageType => {\n    if (previousMessage.toLowerCase().indexOf(damageType.toLowerCase()) != -1){\n        damageTypesOfPrevousMsg.push(damageType);\n    }\n});\ndamageTypesOfPrevousMsg.forEach(damageType => {\n    msg = msg.replaceAllCaseInsensitive(damageType, `<span style=\"color:red; font-weight: bold;\">${damageType}</span>`);\n});\n\n\nif (msg.length === 0) {\n    msg = \"No tokens selected.\";\n}\n\nui.notifications.info(msg);\n\n// Post message to self\n/*ChatMessage.create({\n    content: msg,\n    whisper: [game.user._id]\n});*/","author":"FFUC3PaRivS4DAFM","img":"icons/svg/dice-target.svg","ownership":{"default":0,"y5gmtwxmW3A5ZuOP":3,"FFUC3PaRivS4DAFM":3},"folder":null,"sort":0,"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1678629978421,"modifiedTime":1678629978421,"lastModifiedBy":"FFUC3PaRivS4DAFM"},"_id":"GCFNOTKS9WVnUco8"}
{"type":"script","scope":"actor","name":"Potion of Healing","img":"icons/consumables/potions/potion-tube-corked-red.webp","command":"dnd5e.documents.macro.rollItem(\"Potion of Healing\")","flags":{"dnd5e":{"itemMacro":true}},"author":"Lr8wBSyxt7lTL8nS","folder":null,"sort":0,"ownership":{"default":0,"Lr8wBSyxt7lTL8nS":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1680464819403,"modifiedTime":1680464819403,"lastModifiedBy":"Lr8wBSyxt7lTL8nS"},"_id":"GN8sO5y8qHpyEcwJ"}
{"type":"script","scope":"actor","name":"Rations","img":"icons/consumables/meat/hock-leg-pink-brown.webp","command":"dnd5e.documents.macro.rollItem(\"Rations\")","flags":{"dnd5e":{"itemMacro":true}},"author":"Lr8wBSyxt7lTL8nS","folder":null,"sort":0,"ownership":{"default":0,"Lr8wBSyxt7lTL8nS":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1680887152381,"modifiedTime":1680887152381,"lastModifiedBy":"Lr8wBSyxt7lTL8nS"},"_id":"Gmw5xwSU3QzuvtqV"}
{"name":"Display Mage Armor","type":"script","img":"icons/svg/book.svg","command":"Hotbar.toggleDocumentSheet(\"Actor.eZR2IeHcZHMxON7u.Item.lJSAjKOOimSQdL3T\")","author":"FPvmjzQgqPQsRLle","scope":"global","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"flags":{},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1674828304028,"modifiedTime":1674828304028,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"IeGEPcwjrWdtNGIO"}
{"type":"script","scope":"actor","name":"Color Spray","img":"icons/magic/air/fog-gas-smoke-dense-pink.webp","command":"dnd5e.documents.macro.rollItem(\"Color Spray\")","flags":{"dnd5e":{"itemMacro":true}},"author":"FPvmjzQgqPQsRLle","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1676045009350,"modifiedTime":1676045009350,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"Jk3KrZPZCFtyHjjA"}
{"type":"script","scope":"actor","name":"Sacred Flame","img":"icons/magic/light/beam-rays-orange.webp","command":"dnd5e.documents.macro.rollItem(\"Sacred Flame\")","flags":{"dnd5e":{"itemMacro":true}},"author":"FPvmjzQgqPQsRLle","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1676045247203,"modifiedTime":1676045247203,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"LxymNQGUjdl3AEuM"}
{"name":"New Macro","type":"chat","scope":"global","author":"FPvmjzQgqPQsRLle","img":"icons/svg/dice-target.svg","command":"","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"flags":{},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1673801748219,"modifiedTime":1673801748219,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"NowtCuNsiqHuz6lX"}
{"name":"Monk Ki","type":"script","author":"FFUC3PaRivS4DAFM","img":"icons/svg/dice-target.svg","scope":"global","command":"/**\n * Monk Ki Point spender\n * \n * This macro will prompt which Feature you want to spend Ki points on.\n * \n * Flurry of Blows: Automatically cast two Unarmed Strike's\n * Stunning Strike: Automatically show the saving throw DC\n * Deflect Missiles: Automatically show the damage reduction\n */\n(async () => {\n    const kiName = \"Ki Points\";\n    const errNoMonkToken = \"Please select a single monk token.\";\n\n    const sendChat = async (msg) => {\n        let chatData = {\n            user: game.user.id,\n            speaker: ChatMessage.getSpeaker(),\n            content: msg,\n        };\n        ChatMessage.create(chatData, {});\n    }\n\n    if (!actor) {\n        ui.notifications.warn(errNoMonkToken);\n        return\n    }\n\n    let monk = actor.items.find(i => i.name === 'Monk' && i.type === 'class');\n    if (!monk) {\n        ui.notifications.warn(errNoMonkToken);\n        return\n    }\n\n    let monkLevels = monk.data.data.levels || 20;\n    //let subClass = monk.data.data.subclass;\n\n    if (monkLevels < 2) {\n        ui.notifications.warn('You must have a least 2 Monk levels to use ki points.');\n        return\n    }\n\n    class KiFeature {\n        /**\n         * @param {string} name\n         * @param {string} fallbackText\n         * @param {number} requireLevel\n         * @param {function} action\n         * @param {function} appendTemplate\n         * @param {number} kiCost\n         */\n        constructor(name, fallbackText, requireLevel, action, appendTemplate, kiCost) {\n            this.name = name;\n            this.fallbackText = fallbackText;\n            this.requireLevel = requireLevel;\n            this.kiCost = kiCost || 1;\n            if (action) {\n                this.action = action;\n            }\n            if (appendTemplate) {\n                this.appendTemplate = appendTemplate;\n            }\n        }\n\n        render(allowHigher) {\n            let entry = null;\n\n            const pack = game.packs.get(\"dnd5e.classfeatures\");\n            if (!pack) {\n                console.warn('Could not find \"dnd5e.classfeatures\" compendium.');\n            } else {\n                entry = pack.index.find(e => e.name === this.name);\n            }\n\n            if (!allowHigher && this.requireLevel && monkLevels && this.requireLevel > monkLevels) {\n                ui.notifications.warn(`You need to have ${this.requireLevel} monk levels, you only have ${monkLevels}.`)\n                return\n            }\n\n            if (entry) {\n                pack.getDocument(entry._id).then(o => {\n                    let template = `@Compendium[dnd5e.classfeatures.${entry._id}]{${this.name}}\n                    ${o.data.data.description.value}`;\n                    if (this.appendTemplate) {\n                        template += '\\n\\n' + this.appendTemplate();\n                    }\n                    sendChat(template);\n                    if (this.action) {\n                        this.action();\n                    }\n                });\n            } else {\n                console.warn(`Could not find \"${this.name}\" entry in compendium.`);\n                let template = this.fallbackText;\n                if (this.appendTemplate) {\n                    template += '\\n\\n' + this.appendTemplate();\n                }\n                sendChat(template);\n                if (this.action) {\n                    this.action();\n                }\n            }\n        }\n    }\n\n    const openHand = !!actor.items.find(o => o.data.name === 'Open Hand Technique') ? `<br />In addition, you can impose one of the following: <ul><li>It must succeed on a <b>Dexterity</b> saving throw or be knocked prone.</li><li>It must make a <b>Strength</b> saving throw. If it fails, you can push it up to 15 feet away from you.</li><li>It can’t take reactions until the end of your next turn.</li></ul> Saving throw <b>DC ${10 + actor.data.data.abilities.wis.mod}</b>` : \"\";\n\n    const features = [\n        new KiFeature(\"Ki: Flurry of Blows\",\n            `Immediately after you take the <b>Attack</b> action on your turn, you can spend 1 ki point to make two unarmed strikes as a bonus action. ${openHand}`,\n            2,\n            function () {\n                // Automatically roll two Unarmed Strike attacks\n                let strike = actor.items.find(o => o.data.name === 'Unarmed Strike' && o.labels.activation === '1 Action')\n                if (strike) {\n                    strike.roll();\n                    strike.roll();\n                }\n            }),\n        new KiFeature(\"Ki: Patient Defense\",\n            \"You can spend 1 ki point to take the <b>Dodge</b> action as a bonus action on your turn.\",\n            2),\n        new KiFeature(\"Ki: Step of the Wind\",\n            \"You can spend 1 ki point to take the <b>Disengage</b> or <b>Dash</b> action as a bonus action on your turn, and your jump distance is doubled for the turn.\",\n            2),\n        new KiFeature(\"Deflect Missiles\",\n            `Starting at 3rd level, you can use your reaction to deflect or catch the missile when you are hit by a ranged weapon attack. When you do so, the damage you take from the attack is reduced by 1d10 + your Dexterity modifier + your monk level. <br />\n\n        If you reduce the damage to 0, you can catch the missile if it is small enough for you to hold in one hand and you have at least one hand free. If you catch a missile in this way, you can spend 1 ki point to make a ranged attack with the weapon or piece of ammunition you just caught, as part of the same reaction. You make this attack with proficiency, regardless of your weapon proficiencies, and the missile counts as a monk weapon for the attack, which has a normal range of 20 feet and a long range of 60 feet.`,\n            3,\n            null,\n            function () {\n                return `Damage reduction: [[/r 1d10+${actor.data.data.abilities.dex.mod}+${monkLevels}]]`;\n            }),\n        new KiFeature(\"Ki: Stunning Strike\",\n            \"Starting at 5th level, you can interfere with the flow of ki in an opponent’s body. When you hit another creature with a melee weapon attack, you can spend 1 ki point to attempt a stunning strike. The target must succeed on a Constitution saving throw or be <b>stunned</b> until the end of your next turn.\",\n            5,\n            null,\n            function () {\n                // Append the saving throw DC to the chat message\n                return `CON saving throw (DC [[8+${actor.data.data.abilities.wis.mod}+@attributes.prof]])`;\n            }),\n        new KiFeature(\"Ki: Diamond Soul\",\n            `Beginning at 14th level, your mastery of ki grants you proficiency in all saving throws.\n\n        Additionally, whenever you make a saving throw and fail, you can spend 1 ki point to reroll it and take the second result.`,\n            14),\n        new KiFeature(\"Ki: Empty Body\",\n            `Beginning at 18th level, you can use your action to spend 4 ki points to become invisible for 1 minute. During that time, you also have resistance to all damage but force damage.\n\n        Additionally, you can spend 8 ki points to cast the astral projection spell, without needing material components. When you do so, you can’t take any other creatures with you.`,\n            18,\n            null,\n            function () {\n                return \"Note: 4 ki points have been spent. Adjust manually if casting astral projection spell.\";\n            },\n            4),\n    ];\n\n    const consumeKi = (feature, allowNegative, allowHigher) => {\n        let hasAvailableResource = false;\n        let selected = features.find(o => o.name == feature);\n        let kiCost = selected.kiCost || 1;\n\n        // Look for Resources under the Core actor data\n        let resourceKey = Object.keys(actor.data.data.resources).filter(k => actor.data.data.resources[k].label === kiName).shift();\n        if (resourceKey && (actor.data.data.resources[resourceKey].value >= kiCost || allowNegative)) {\n            hasAvailableResource = true;\n            actor.data.data.resources[resourceKey].value -= kiCost;\n        }\n\n        // Look for Ki Points Feat that has uses\n        actor.items.filter(i => i.data.name === kiName && i.hasLimitedUses && (i.data.data.uses.value >= kiCost || allowNegative)).forEach(i => {\n            hasAvailableResource = true;\n            i.data.data.uses.value -= kiCost\n        })\n\n        if (!hasAvailableResource) {\n            ui.notifications.warn(`${actor.name} does not have any ${kiName} left!`);\n            return false;\n        }\n        if (actor.sheet.rendered) {\n            // Update the actor sheet if it is currently open\n            actor.render(true);\n        }\n\n        if (selected) {\n            selected.render(allowHigher);\n        }\n\n        return true;\n    };\n\n    (async () => {\n        let template = `\n        <form>\n            <div class=\"form-group\">\n                <label>Select feature:</label>\n                <select id=\"feature\" name=\"feature\">`\n        features.filter(o => o.requireLevel <= monkLevels).forEach(o => {\n            template += `<option value=\"${o.name}\">${o.name}</option>`;\n        });\n        template += `</select>\n            </div>\n            <div class=\"form-group\">\n                <label>Allow consuming Ki into negative? <input type=\"checkbox\" id=\"allow-negative\" name=\"allow-negative\" value=\"1\"></label>\n            </div>\n            <div class=\"form-group\">\n                <label>Allow consuming Ki feats of higher level? <input type=\"checkbox\" id=\"allow-higher\" name=\"allow-higher\" value=\"1\"></label>\n            </div>\n        </form>`;\n        new Dialog({\n            title: `Monk Ki Point Spender`,\n            content: template,\n            buttons: {\n                yes: {\n                    icon: \"<i class='fas fa-check'></i>\",\n                    label: `Apply`,\n                    callback: (html) => {\n                        let feature = html.find('#feature')[0].value;\n                        let allowNegative = html.find('#allow-negative')[0].checked;\n                        let allowHigher = html.find('#allow-higher')[0].checked;\n                        consumeKi(feature, allowNegative, allowHigher);\n                    }\n                },\n                no: {\n                    icon: \"<i class='fas fa-times'></i>\",\n                    label: `Cancel`\n                },\n            },\n            default: \"yes\"\n        }).render(true);\n    })();\n})()","folder":null,"sort":0,"flags":{"core":{"sourceId":"Compendium.foundry_community_macros.community-macros-5e.WC2Yl843kA4sjrUz"}},"ownership":{"default":0,"y5gmtwxmW3A5ZuOP":3,"FFUC3PaRivS4DAFM":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1678629914114,"modifiedTime":1678629914114,"lastModifiedBy":"FFUC3PaRivS4DAFM"},"_id":"PAfXLfR5f17cADRx"}
{"name":"Enable Quest Tracker","type":"script","command":"const newState = !game.settings.get('forien-quest-log', 'questTrackerEnable');\nawait game.settings.set('forien-quest-log', 'questTrackerEnable', newState);","img":"modules/forien-quest-log/assets/icons/macros/questTrackerEnableOff.png","flags":{"forien-quest-log":{"macro-setting":"questTrackerEnable"}},"author":"FFUC3PaRivS4DAFM","scope":"global","folder":null,"sort":0,"ownership":{"default":0,"FFUC3PaRivS4DAFM":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678629852542,"modifiedTime":1686666501272,"lastModifiedBy":"FFUC3PaRivS4DAFM"},"_id":"PRJ0W41NgJeX16nI"}
{"name":"New Macro","type":"chat","scope":"global","author":"FPvmjzQgqPQsRLle","img":"icons/svg/dice-target.svg","command":"","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"flags":{},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1673801790729,"modifiedTime":1673801790729,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"Q4tnk9wXFezDBhka"}
{"type":"script","scope":"actor","name":"Mending","img":"icons/magic/air/wind-stream-purple-blue.webp","command":"dnd5e.documents.macro.rollItem(\"Mending\")","flags":{"dnd5e":{"itemMacro":true}},"author":"FPvmjzQgqPQsRLle","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1673801860959,"modifiedTime":1673801860959,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"SKqjZ0r4XKKL42d2"}
{"type":"script","scope":"actor","name":"Thieves' Tools","img":"icons/tools/hand/lockpicks-steel-grey.webp","command":"dnd5e.documents.macro.rollItem(\"Thieves' Tools\")","flags":{"dnd5e":{"itemMacro":true}},"author":"Lr8wBSyxt7lTL8nS","folder":null,"sort":0,"ownership":{"default":0,"Lr8wBSyxt7lTL8nS":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1684516341303,"modifiedTime":1684516341303,"lastModifiedBy":"Lr8wBSyxt7lTL8nS"},"_id":"SKy6eWHapQuZRypy"}
{"type":"script","scope":"actor","name":"Священное пламя","img":"icons/svg/item-bag.svg","command":"dnd5e.documents.macro.rollItem(\"Священное пламя\")","flags":{"dnd5e":{"itemMacro":true}},"author":"FPvmjzQgqPQsRLle","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1678630592360,"modifiedTime":1678630592360,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"XzGfluyi7JSmSUIo"}
{"name":"New Macro","type":"chat","scope":"global","author":"FPvmjzQgqPQsRLle","img":"icons/svg/dice-target.svg","command":"","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"flags":{},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1673802272522,"modifiedTime":1673802272522,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"YW9CYdwVQb6eZcJo"}
{"name":"Open Quest Log","type":"script","command":"Hooks.call('ForienQuestLog.Open.QuestLog');","img":"modules/forien-quest-log/assets/icons/macros/openQuestLog.png","flags":{},"author":"FFUC3PaRivS4DAFM","scope":"global","folder":null,"sort":0,"ownership":{"default":0,"FFUC3PaRivS4DAFM":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1678629845939,"modifiedTime":1678629845939,"lastModifiedBy":"FFUC3PaRivS4DAFM"},"_id":"ZUCf6CDYd6gcbMIO"}
{"name":"New Macro","type":"chat","scope":"global","author":"Lr8wBSyxt7lTL8nS","img":"icons/svg/dice-target.svg","command":"","folder":null,"sort":0,"ownership":{"default":0,"Lr8wBSyxt7lTL8nS":3},"flags":{},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1674832395781,"modifiedTime":1674832395781,"lastModifiedBy":"Lr8wBSyxt7lTL8nS"},"_id":"am9MwBKuCkgcK1eI"}
{"type":"script","scope":"actor","name":"Poison Spray","img":"icons/creatures/slimes/slime-movement-splash-green.webp","command":"dnd5e.documents.macro.rollItem(\"Poison Spray\")","flags":{"dnd5e":{"itemMacro":true}},"author":"FPvmjzQgqPQsRLle","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1677421858036,"modifiedTime":1677421858036,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"bTtFViQglkANMA7Z"}
{"type":"script","scope":"actor","name":"Lesser Restoration","img":"icons/magic/life/heart-cross-blue.webp","command":"dnd5e.documents.macro.rollItem(\"Lesser Restoration\")","flags":{"dnd5e":{"itemMacro":true}},"author":"FPvmjzQgqPQsRLle","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1676044861934,"modifiedTime":1676044861934,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"dVI9lri7mqX6NfrZ"}
{"type":"script","scope":"actor","name":"Mage Hand","img":"icons/magic/light/orbs-hand-gray.webp","command":"dnd5e.documents.macro.rollItem(\"Mage Hand\")","flags":{"dnd5e":{"itemMacro":true}},"author":"FPvmjzQgqPQsRLle","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1677424059022,"modifiedTime":1677424059022,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"hBRUo2HF8LZSJJ50"}
{"name":"Random Inspiration","type":"script","author":"FFUC3PaRivS4DAFM","img":"icons/svg/dice-target.svg","scope":"global","command":"// Courtesy of @Zarek\n// Selected target receives a random inspiration from a table called \"inspirations\".\n// You can find a table called inspirations in the community tables module\n\n// Setup variables\nlet tableName = \"Inspirations\";\n\nlet bardicInspiration = async() => {\n  if (!actor) {\n    ui.notifications.warn(\"You must have an actor selected.\");\n    return\n  }\n\n  // Get Targets name\n  let actorLevels = actor.data.data.levels || 1;\n  const targetId = game.user.targets.ids[0];\n  const targetToken = canvas.tokens.get(targetId);\n  if (!targetToken) {\n    ui.notifications.warn(\"You must target a token.\");\n    return\n  }\n  const targetName = targetToken.name;\n\n\n  let table = game.tables.contents.find(t => t.name == tableName);\n\n  //default inspiration if no table is found.\n  //let inspiration = \"Cowards die many times before their deaths; the valiant never taste death but once.\";\n  let inspiration = `I don't know what effect ${targetName} will have upon the enemy, but, by God, he terrifies me.`;\n  \n  // Roll the result, and mark it drawn\n  if (table) {\n    if (checkTable(table)) {\n      // let result = table.roll()[1];\n      let roll = await table.roll();\n      let result = roll.results[0];\n      inspiration = result.data.text;\n      await table.updateEmbeddedDocuments(\"TableResult\", [{\n        _id: result.id,\n        drawn: true\n      }]);\n    }\n  }\n\n  function checkTable(table) {\n    let results = 0;\n    for (let data of table.data.results) {\n      if (!data.drawn) {\n        results++;\n      }\n    }\n    if (results < 1) {\n      table.reset();\n      ui.notifications.notify(\"Table Reset\")\n      return false\n    }\n    return true\n  }\n\n  let dieType = 'd6';\n  if (actorLevels >= 15) {\n    dieType = 'd12';\n  } else if (actorLevels >= 10) {\n    dieType = 'd10';\n  } else if (actorLevels >= 5) {\n    dieType = 'd8';\n  }\n\n  let messageContent = '';\n  messageContent += `<p>${token.name} exclaims <b><i>\"${inspiration}\"</i></b></p>`\n  messageContent += `<p>${targetName} is inspired.</p>`\n  messageContent += `<details closed=\"\"><summary><a>Bardic Inspiration</a></summary><p>${targetName} gains one Bardic Inspiration die, a <strong>${dieType}</strong>.<br>Once within the next 10 minutes, ${targetName} can roll the die and add the number rolled to one <b>ability check, attack roll, or saving throw</b>. ${targetName} can wait until after it rolls the <strong>d20</strong> before deciding to use the Bardic Inspiration die, but must decide before the DM says whether the roll succeeds or fails. Once the Bardic Inspiration die is rolled, it is lost.</p></details>`\n\n  // create the message\n  if (messageContent !== '') {\n    let chatData = {\n      user: game.user.id,\n      speaker: ChatMessage.getSpeaker(),\n      content: messageContent,\n    };\n    ChatMessage.create(chatData, {});\n  }\n};\nbardicInspiration();","folder":null,"sort":0,"flags":{"core":{"sourceId":"Compendium.foundry_community_macros.community-macros-5e.XuT5kNbIerT7CGoA"}},"ownership":{"default":0,"y5gmtwxmW3A5ZuOP":3,"FFUC3PaRivS4DAFM":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1678629971052,"modifiedTime":1678629971052,"lastModifiedBy":"FFUC3PaRivS4DAFM"},"_id":"iPoLIbBe2jcdvH4w"}
{"type":"script","scope":"actor","name":"Sharpshooter","img":"modules/plutonium/media/icon/feat/phb-sharpshooter.webp","command":"dnd5e.documents.macro.rollItem(\"Sharpshooter\")","flags":{"dnd5e":{"itemMacro":true}},"author":"Lr8wBSyxt7lTL8nS","folder":null,"sort":0,"ownership":{"default":0,"Lr8wBSyxt7lTL8nS":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1676663602890,"modifiedTime":1676663602890,"lastModifiedBy":"Lr8wBSyxt7lTL8nS"},"_id":"kVOPNFsk5IfCtXCu"}
{"type":"script","scope":"actor","name":"Counterspell","img":"icons/creatures/abilities/wolf-heads-swirl-purple.webp","command":"dnd5e.documents.macro.rollItem(\"Counterspell\")","flags":{"dnd5e":{"itemMacro":true}},"author":"FPvmjzQgqPQsRLle","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1679673648746,"modifiedTime":1679673648746,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"kqbvpm5GRGhj9RDe"}
{"type":"script","scope":"actor","name":"Жестокий выстрел","img":"icons/svg/item-bag.svg","command":"dnd5e.documents.macro.rollItem(\"Жестокий выстрел\")","flags":{"dnd5e":{"itemMacro":true}},"author":"Lr8wBSyxt7lTL8nS","folder":null,"sort":0,"ownership":{"default":0,"Lr8wBSyxt7lTL8nS":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1674831908665,"modifiedTime":1674831908665,"lastModifiedBy":"Lr8wBSyxt7lTL8nS"},"_id":"lksE4gMZatldcM49"}
{"name":"Stealth Check","type":"script","author":"S0SV5Xx9zmdnNIfn","img":"icons/svg/dice-target.svg","scope":"global","command":"// Grabs selected tokens and rolls a stealth check against all other tokens passive perception on the map. Then returns the result.\n\n// getting all actors of selected tokens\nlet actors = canvas.tokens.controlled.map(({ actor }) => actor);\n\n// if there are no selected tokens, roll for the player's character.\nif (actors.length < 1 && game.user.character) {\n  actors = [game.user.character];\n}\nconst validActors = actors.filter(actor => actor != null);\n\nlet messageContent;\nif (validActors.length) {\n  messageContent = 'pp = passive perception<br>';\n} else {\n  messageContent = 'No tokens selected, please select at least one.';\n}\n// roll for every actor\nfor (const selectedActor of validActors) {\n  const stealthMod = selectedActor.data.data.skills.ste.total; // stealth roll\n  const result = await new Roll(`1d20+${stealthMod}`).roll({async: true});\n  const stealth = result.total; // rolling the formula\n  messageContent += `<hr><h3>${selectedActor.name} stealth roll was a <b>${stealth}</b> (1d20 + ${stealthMod}).</h3>`; // creating the output string\n\n  // grab a list of unique tokens then check their passive perception against the rolled stealth.\n  const uniqueActor = {};\n  const caughtBy = canvas.tokens.placeables\n    .filter(token => !!token.actor)\n    .filter(({ actor }) => actor.data.data.attributes.hp.value > 0) // filter out dead creatures.\n    .filter(({ actor }) => { // filter out duplicate token names. ie: we assume all goblins have the same passive perception\n      if (uniqueActor[actor.name]) {\n        return false;\n      }\n      uniqueActor[actor.name] = true;\n      return true;\n    })\n    .filter(({ actor }) => {\n      return selectedActor.id !== actor.id; // Don't check to see if the token sees himself.\n    })\n    .filter(({ actor }) => actor.data.data.skills.prc.passive >= stealth); // check map tokens passives with roller stealth\n\n  if (!caughtBy.length) {\n    messageContent += 'Stealth successful!<br>';\n  } else {\n    messageContent += 'Stealth questionable:<br>';\n    caughtBy.map(({ actor }) => {\n      messageContent += `<b>${actor.name}</b> pp(${actor.data.data.skills.prc.passive}).<br>`;\n    });\n  }\n}\n\n// create the message\nconst chatData = {\n  user: game.user._id,\n  speaker: game.user,\n  content: messageContent,\n  whisper: game.users.filter((u) => u.isGM).map((u) => u._id),\n};\nChatMessage.create(chatData, {});","folder":null,"sort":0,"flags":{"core":{"sourceId":"Compendium.foundry_community_macros.community-macros-5e.2RitOkKtnQe9pbuF"}},"ownership":{"default":0,"y5gmtwxmW3A5ZuOP":3,"S0SV5Xx9zmdnNIfn":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1678629913702,"modifiedTime":1678629913702,"lastModifiedBy":"S0SV5Xx9zmdnNIfn"},"_id":"lpfdXfrX5ivk4J99"}
{"name":"New Macro","type":"chat","scope":"global","author":"Lr8wBSyxt7lTL8nS","img":"icons/svg/dice-target.svg","command":"","folder":null,"sort":0,"ownership":{"default":0,"Lr8wBSyxt7lTL8nS":3},"flags":{},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1674832467521,"modifiedTime":1674832467521,"lastModifiedBy":"Lr8wBSyxt7lTL8nS"},"_id":"pevApvzvZDxRgtMB"}
{"name":"New Macro","type":"chat","scope":"global","author":"FPvmjzQgqPQsRLle","img":"icons/svg/dice-target.svg","command":"","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"flags":{},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1673532045842,"modifiedTime":1673532045842,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"ra6zJXP60bnmaUUd"}
{"name":"All Token’s Passive Perception","type":"script","author":"FFUC3PaRivS4DAFM","img":"icons/svg/dice-target.svg","scope":"global","command":"// Pull the passive perception of each token in the current scene and whisper the results to the GM.\n// Only tested with the 5e System in Foundry.\n// Author: @Drunemeton#7955. Based on the original macro by author @Erogroth#7134.\n\n// Initalize variables.\nlet pcArray = [];\nlet npcArray = [];\nlet messageContentPC = \"\";\nlet messageContentNPC = \"\";\nlet messageHeaderPC = \"<b>PC Passive Perception</b><br>\";\nlet messageHeaderNPC = \"<b>NPC Passive Perception</b><br>\";\n\n// Gather tokens in the current scene into an array.\nlet tokens = canvas.tokens.placeables.filter((token) => token.data && token.actor);\n\n// From the tokens array sort into PC and NPC arrays.\nfor (let count of tokens) {\n  let tokenType = count.actor.data.type;\n  let tokenName = count.data.name;\n  let tokenPassive = count.actor.data.data.skills.prc.passive;\n  \n  if(tokenType === \"character\") {\n    pcArray.push({ name: tokenName, passive: tokenPassive });\n  } \n  if(tokenType === \"npc\") {\n    npcArray.push({ name: tokenName, passive: tokenPassive });\n  }\n}\n\n// Sort each array.\nsortArray(pcArray);\nsortArray(npcArray);\n\n// Build chat message, with PCs first, then NPCs.\nfor (let numPC of pcArray) {\n  messageContentPC += `${numPC.name}: <b>${numPC.passive}</b><br>`;\n}\nfor (let numNPC of npcArray) {\n  messageContentNPC += `${numNPC.name}: <b>${numNPC.passive}</b><br>`;\n}\n\nlet chatMessage = (messageHeaderPC + messageContentPC + `<br>` + messageHeaderNPC + messageContentNPC);\n\nlet chatData = {\n  user: game.user._id,\n  speaker: ChatMessage.getSpeaker(),\n  content: chatMessage,\n  whisper: game.users.filter((u) => u.isGM).map((u) => u._id),\n};\n\n// Display chat message.\nChatMessage.create(chatData, {});\n\n// Sort each array by Name.\n  function sortArray(checkArray) {\n    checkArray.sort(function (a, b) {\n      var nameA = a.name.toUpperCase(); // ignore upper and lowercase\n      var nameB = b.name.toUpperCase(); // ignore upper and lowercase\n      if (nameA < nameB) {\n        return -1;\n      }\n      if (nameA > nameB) {\n        return 1;\n      }\n      // names must be equal\n      return 0;\n    });\n\n    // Sort array by Passive Perception.\n    checkArray.sort(function (a, b) {\n      return b.passive - a.passive;\n    });\n  }","folder":null,"sort":0,"flags":{"core":{"sourceId":"Compendium.foundry_community_macros.community-macros-5e.DBlk2wFOpxxhM9eC"}},"ownership":{"default":0,"y5gmtwxmW3A5ZuOP":3,"FFUC3PaRivS4DAFM":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1678629926022,"modifiedTime":1678629926022,"lastModifiedBy":"FFUC3PaRivS4DAFM"},"_id":"xIyHVEzhuaN1dilA"}
{"type":"script","scope":"actor","name":"Mage Armor","img":"icons/equipment/chest/breastplate-helmet-metal.webp","command":"dnd5e.documents.macro.rollItem(\"Mage Armor\")","flags":{"dnd5e":{"itemMacro":true}},"author":"FPvmjzQgqPQsRLle","folder":null,"sort":0,"ownership":{"default":0,"FPvmjzQgqPQsRLle":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1678651253137,"modifiedTime":1678651253137,"lastModifiedBy":"FPvmjzQgqPQsRLle"},"_id":"ygTYRMKLvn2nfj58"}
{"type":"script","scope":"actor","name":"Пистоль Картера","img":"icons/svg/item-bag.svg","command":"dnd5e.documents.macro.rollItem(\"Пистоль Картера\")","flags":{"dnd5e":{"itemMacro":true}},"author":"Lr8wBSyxt7lTL8nS","folder":null,"sort":0,"ownership":{"default":0,"Lr8wBSyxt7lTL8nS":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.1","coreVersion":"10.291","createdTime":1674832364833,"modifiedTime":1674832364833,"lastModifiedBy":"Lr8wBSyxt7lTL8nS"},"_id":"ytL56gWe08YX6XWT"}
{"name":"New Macro","type":"chat","scope":"global","author":"S0SV5Xx9zmdnNIfn","img":"icons/svg/dice-target.svg","command":"","folder":null,"sort":0,"ownership":{"default":0,"S0SV5Xx9zmdnNIfn":3},"flags":{},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1678910530308,"modifiedTime":1678910530308,"lastModifiedBy":"S0SV5Xx9zmdnNIfn"},"_id":"zWgNVhN2AlLk2cop"}
{"name":"Enable Quest Tracker","type":"script","command":"const newState = !game.settings.get('forien-quest-log', 'questTrackerEnable');\nawait game.settings.set('forien-quest-log', 'questTrackerEnable', newState);","img":"modules/forien-quest-log/assets/icons/macros/questTrackerEnableOff.png","flags":{"forien-quest-log":{"macro-setting":"questTrackerEnable"}},"author":"FFUC3PaRivS4DAFM","scope":"global","folder":null,"sort":0,"ownership":{"default":0,"FFUC3PaRivS4DAFM":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1678629852542,"modifiedTime":1687084086172,"lastModifiedBy":"FFUC3PaRivS4DAFM"},"_id":"PRJ0W41NgJeX16nI"}
